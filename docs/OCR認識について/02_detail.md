# 2. 詳細

### 2.1. アルゴリズム

深層学習の物体検出により数字を検出し、次に、検出されたすべての数字を後段のアルゴリズムで処理することで数値として出力しています。
メーター画像全体から数字を検出する物体検出方式を採用することにより、数字の領域を一つ一つ指定する必要がないために設定が容易なことに加え、設置後に多少位置がずれても影響を受けにくく、ロバストな検出が可能です。

### 2.2. 認識精度

2022/2/25現在、認識精度は下記の通りです。
認識精度は設置環境等によって変動しますので、認識精度を保証するものではなく参考値とさせていただきます。
カウンタメータは、回転途中の値があると誤検出することがあります。

- デジタルメータ 99.99%
- カウンタメータ 99.68%

※ 上記精度は mAP@IoU=0.5 の値となります

> mAP は mean Average Precision、IoU は Intersection over Union を示します。
>
> 0~9の10クラスの数字を検出しますが、それぞれのクラスの検出精度は平均適合率(AP)で算出します。平均適合率は、適合率(Precision)と再現率(Recall)からなるPR曲線から算出されます。各クラスにおける平均適合率の単純平均が mAP となります。
>
> IoU=0.5 は、数字として予測した領域と、正解の領域と重なっている部分の面積の比率が0.5ということを意味します。つまり、モデルによって予測した領域が正解に対して半分以上重なっていれば正しく検出できたとみなして精度を計算します。

### 2.3. 学習済みモデル

OCR認識では、あらかじめ生成された専用の「学習済みモデル」を使用して機械学習の推論を行います。現在この学習済みモデルは、デジタルメータ用とカウンタメータ用の2種類で運用されています。

### 2.4. 追加学習

新規のメーターや、実績のあるメーターであっても環境条件等が従来と異なるような場合には、既存の学習済みモデルでは正しく認識できない場合があります。そのような場合には、当該メーターの画像データを使用して追加学習を行って学習済みモデルを更新することで認識精度が改善します。

> 追加学習および学習済みモデルの更新はアドバリーシステムが適宜行います。
> 学習用の画像データ収集および学習済みモデル生成にかかる時間は、1時間おきの検針の場合でおよそ3日～7日です。

本システムは、自動で追加学習することはできません。誤検出した値をサイト上で修正できる機能がありますが、データベースの値を書き換えているだけで、学習済みモデルには反映されませんのでご注意ください。

ごく稀に、追加学習により既存の検出精度が悪化する場合があります。これは、学習データを追加していくことにより、学習済みモデルの汎化性能（未知のデータを予測する能力）が向上する反面、過学習気味であった既知の数字形状の認識能力が鈍感になるために起こります。
追加学習が既存の認識精度に大きく影響する場合は、学習済みモデルの分離を行うなどの対策をすることで精度を維持することが可能になります。本システムでは、学習済みモデルの分離を容易にできるように設計されています。

### 2.5. アルゴリズム改良

新規メーターの種類によっては、学習済みモデルの更新だけでは対応できない場合があります。
本システムは未知のメーターに対しても比較的柔軟に対応できるように設計されていますので、そのような場合でも、後段のアルゴリズム側にロジックを追加することで対応が可能になる場合があります（別途相談）。
